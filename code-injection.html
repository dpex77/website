<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Code Injection</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      margin: 20px;
      max-width: 900px;
    }
    h1, h2, h3, h4 {
      color: #333;
    }
    code, pre {
      background: #f4f4f4;
      padding: 5px 10px;
      border-radius: 5px;
      display: block;
      margin: 10px 0;
      white-space: pre-wrap;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #eee;
    }
  </style>
</head>
<body>

<h1>Code Injection</h1>

<h2>1. Overview:</h2>
<p>Code injection would mean injecting the malicious code into the application so they get executed. Code injection usually runs with the context of the application itself. So, code injection typically compromises the application but may not directly affect the entire system. Code injection usually targets the application’s runtime environment (e.g., Python, PHP, Java, JavaScript).</p>

<h2>2. Vulnerability from an Attacker Perspective</h2>
<p>From an attacker’s point of view, this vulnerability is highly valuable because it provides a direct path to remote code execution (RCE). Once RCE is achieved, the attacker can perform a wide variety of malicious actions, such as:</p>
<ul>
  <li><b>Arbitrary Command Execution</b> – The attacker can run system-level commands (<code>rm -rf /</code>, <code>cat /etc/passwd</code>, <code>netstat</code>, etc.).</li>
  <li><b>File System Access</b> – Sensitive files such as <code>/etc/shadow</code>, database credentials, or API keys can be accessed and exfiltrated.</li>
  <li><b>Persistence and Lateral Movement</b> – Attackers can create backdoors or install malicious packages.</li>
  <li><b>Privilege Escalation Opportunities</b> – If the vulnerable application is running with elevated privileges.</li>
  <li><b>Stealthy Abuse</b> – Harvest sensitive data or manipulate application logic silently.</li>
  <li><b>Exploitation of the Runtime Environment</b> – Load arbitrary modules like <code>os</code>, <code>subprocess</code>, <code>socket</code>, <code>requests</code>.</li>
  <li><b>Business and Operational Impact</b> – Service disruption, data breaches, and loss of trust.</li>
</ul>

<p>An attacker needs to know what type of code application is using and craft malicious code. This is unlike command injection. The code injection exploits the language interpreter itself (Python in this case). It runs inside the application’s process, with the same privileges as the app and you can manipulate variables, import modules, access memory, etc.</p>

<p>Here you are not limited to system commands — you can access internal data, override functions, manipulate files, open network connections, etc.</p>

<h3>Discovery Techniques:</h3>
<ul>
  <li><b>Error Messages</b> – Verbose messages reveal interpreter/language.</li>
  <li><b>Behavioral Clues</b> – Input/output formatting can leak info.</li>
  <li><b>Payload Probing</b> – Test inputs like <code>1+1</code>, <code>"a"*5</code>, <code>__import__('os')</code>.</li>
  <li><b>Common Frameworks</b> – If stack is known, language is inferred.</li>
</ul>

<p>Once identified, the attacker crafts payloads specific to that interpreter. For example:</p>
<pre>Python → __import__('os').system('id')
PHP → system('id') or eval($_GET['cmd']);
Java → Runtime.getRuntime().exec()</pre>

<h2>2.1 Attempts of an attacker:</h2>
<pre>
user = input("Enter the first number: ")
user1 = input("enter the second number: ")

evaluated = eval(user) + eval(user1)
print(evaluated)
</pre>
<p><b>Example Output:</b></p>
<pre>
Enter the first number: 10
enter the second number: 15
25
</pre>

<p><b>Malicious Payload Example:</b></p>
<pre>
Enter the first number: __import__('os').system('rm -rf /')
enter the second number:
</pre>

<p>Another example:</p>
<pre>
Enter the first number: __import__('subprocess').getoutput('ls')
enter the second number:
</pre>

<p>Another dangerous function is <code>exec</code>:</p>
<pre>
exec("for i in range(3): print(i)")
# prints 0 1 2

user_code = input("Enter Python code: ")
exec(user_code)
</pre>

<h2>3. Vulnerability from a defender perspective:</h2>
<ul>
  <li><b>Never trust user input</b></li>
  <li><b>Input validation</b> – Enforce types and patterns.</li>
  <li><b>Input Sanitization</b> – Strip unsafe characters.</li>
  <li><b>Avoid dynamic code execution</b> – Don’t use <code>eval</code> or <code>exec</code>.</li>
  <li><b>Use contextual encoding</b> – Ensure user input is treated as data.</li>
</ul>

<h3>3.1 Solutions of a defender:</h3>
<h4>Avoid eval()</h4>
<p><b>Safe Alternative (math evaluation only):</b></p>
<pre>
import ast

try:
    user = ast.literal_eval(input("Enter the first number: "))
    user1 = ast.literal_eval(input("Enter the second number: "))
    print(user + user1)
except Exception:
    print("Invalid input!")
</pre>

<p><b>Other Safer Libraries:</b> decimal.Decimal, sympy, numexpr</p>

<h4>Avoid exec()</h4>
<p>There’s no safe equivalent in the Python stdlib. Use sandboxing (RestrictedPython, containers, etc.).</p>

<h2>4. Extras:</h2>
<h3>Difference from Command Injection</h3>
<pre>
import os
user_input = input("Enter filename: ")
os.system(f"cat {user_input}")
</pre>

<p>For example: <code>file.txt; rm -rf /</code></p>

<h4>Comparison Table</h4>
<table>
  <tr>
    <th>Factor</th>
    <th>Command Injection</th>
    <th>Code Injection</th>
  </tr>
  <tr>
    <td>Target</td>
    <td>OS commands</td>
    <td>Application logic + sometimes OS</td>
  </tr>
  <tr>
    <td>Access to app internals</td>
    <td>None</td>
    <td>Full access to variables, memory, functions</td>
  </tr>
  <tr>
    <td>Potential impact</td>
    <td>High (files, network)</td>
    <td>Very High (app logic, secrets, system)</td>
  </tr>
  <tr>
    <td>Exploit complexity</td>
    <td>Usually easier</td>
    <td>Can require knowledge of app structure</td>
  </tr>
  <tr>
    <td>Privileges dependency</td>
    <td>OS-level privileges</td>
    <td>App-level privileges (may escalate)</td>
  </tr>
</table>

<table>
  <tr>
    <th>Factor</th>
    <th>Command Injection</th>
    <th>Code Injection</th>
  </tr>
  <tr>
    <td>Knowledge needed</td>
    <td>Minimal — just find input that reaches shell</td>
    <td>Moderate — need to know language &amp; context</td>
  </tr>
  <tr>
    <td>Exploitation complexity</td>
    <td>Usually easier</td>
    <td>Usually harder</td>
  </tr>
  <tr>
    <td>Impact</td>
    <td>OS-level control, files, network</td>
    <td>App logic + OS (if you can figure it out)</td>
  </tr>
  <tr>
    <td>From IP only (no code access)</td>
    <td>High</td>
    <td>Medium/Low</td>
  </tr>
</table>

</body>
</html>
