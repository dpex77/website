<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Code Injection</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      background: #f4f4f4 url('cloud.jpg') no-repeat top center;
      background-size: cover;
      margin: 0;
      padding: 0;
    }
  .container {
    width: calc(90% - 60px); /* leaves 30px space left and right */
    margin: 30px auto;        /* keeps top space visible */
    background: white;        /* solid white */
    padding: 30px;
    border-radius: 0;
    box-shadow: 0 8px 30px rgba(0,0,0,0.1);
}
    h1, h2, h3 {
      color: #222;
      margin-top: 1.2em;
    }
    pre {
      background: #eee;
      padding: 10px;
      border-radius: 6px;
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 10px;
      text-align: left;
    }
    th {
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Code Injection</h1>

    <h2>1. Overview:</h2>
    <p>
      Code Injection occurs when an attacker supplies input that is directly executed by the application’s runtime environment.
      Insecure use of functions such as <code>eval()</code> or <code>exec()</code> in Python leads to arbitrary code execution.
      Impact ranges from data theft to full system compromise.
    </p>

    <h2>2. Vulnerability from an Attacker Perspective:</h2>
    <p>
      An attacker’s goal is to supply malicious input that the application will evaluate as code, allowing them to run arbitrary logic inside the app process.
    </p>

    <h3>2.1. Experiments for/as Exploit:</h3>
    <pre>
user = input("Enter the first number: ")
user1 = input("Enter the second number: ")
evaluated = eval(user) + eval(user1)
print(evaluated)
    </pre>
    <p><strong>Normal Input:</strong></p>
    <pre>
Enter the first number: 10
Enter the second number: 15
Output: 25
    </pre>
    <p><strong>Malicious Input:</strong></p>
    <pre>
Enter the first number: __import__('os').system('rm -rf /')
Enter the second number:
    </pre>
    <p>
      This executes a system command to delete files. Other payloads include:
    </p>
    <pre>
__import__('subprocess').getoutput('ls')
open('/etc/passwd').read()
    </pre>

    <h2>3. Vulnerability from a Defender Perspective:</h2>
    <p>
      Developers must assume all user input is untrusted and prevent its direct execution as code.
    </p>

    <h3>3.1. Experiments for/as Protection:</h3>
    <ul>
      <li>Replace <code>eval()</code> with safer alternatives like <code>ast.literal_eval()</code>:</li>
    </ul>
    <pre>
import ast
user = ast.literal_eval(input("Enter the first number: "))
user1 = ast.literal_eval(input("Enter the second number: "))
print(user + user1)
    </pre>
    <ul>
      <li>Avoid <code>exec()</code> and dynamic execution functions entirely.</li>
      <li>Apply strict input validation (only allow numbers for numeric input, etc.).</li>
      <li>Sanitize input by removing or escaping unsafe characters.</li>
      <li>Use contextual encoding: HTML, SQL, URL encoding as appropriate.</li>
      <li>Monitor logs and apply WAF rules to detect suspicious payloads.</li>
    </ul>

    <h2>4. Extras:</h2>
    <h3>Comparison with Command Injection</h3>
    <table>
      <tr>
        <th>Factor</th>
        <th>Command Injection</th>
        <th>Code Injection</th>
      </tr>
      <tr>
        <td>Target</td>
        <td>OS commands</td>
        <td>Application logic + runtime</td>
      </tr>
      <tr>
        <td>Knowledge Needed</td>
        <td>Minimal (input reaches shell)</td>
        <td>Moderate (must know language/context)</td>
      </tr>
      <tr>
        <td>Impact</td>
        <td>High (files, network)</td>
        <td>Very High (app logic, secrets, system)</td>
      </tr>
      <tr>
        <td>Exploit Complexity</td>
        <td>Usually easier</td>
        <td>Usually harder</td>
      </tr>
      <tr>
        <td>Privileges</td>
        <td>OS-level</td>
        <td>App-level (may escalate)</td>
      </tr>
    </table>

    <p><strong>References:</strong></p>
    <ul>
      <li><a href="https://owasp.org/Top10/A03_2021-Injection/" target="_blank">OWASP Injection</a></li>
      <li>CWE-94: Improper Control of Generation of Code</li>
    </ul>
  </div>
</body>
</html>
